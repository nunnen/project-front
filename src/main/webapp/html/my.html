<html>
<head>
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link href="/css/my.css" rel="stylesheet">
</head>
<body>
<h1>RPG admin panel</h1>

<label for="dropdown">Count per page:</label>
<select id="dropdown">
    <option value="3" selected>3</option>
    <option value="5">5</option>
    <option value="10">10</option>
    <option value="20">20</option>
</select>

<table id="table">
    <thead>
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Title</th>
            <th>Race</th>
            <th>Profession</th>
            <th>Level</th>
            <th>Birthday</th>
            <th>Banned</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<div id="pagination"></div>


<script>
    const table = document.getElementById("table");

    $(document).ready(function () {
        const pageNumber = 0;
        const pageSize = 3;

        loadData(pageNumber, pageSize);
        updatePagination(pageSize);
    })

    function loadData(pageNumber, pageSize) {
        $.ajax({
            type: "GET",
            url: "/rest/players",
            data: {
                pageNumber: pageNumber,
                pageSize: pageSize
            },
            success: function (response) {
                console.log("Data acquired:", response);
                updateTable(response);
            },

            error: function (error) {
                console.error("Error:", error)
            }
        })
    }

    //обновление таблицы
    function updateTable(data) {
        const tbody = $("#table tbody"); // Находим <tbody>
        tbody.empty(); // Очищаем только <tbody>

        data.forEach((player) => {
            const row = `
            <tr>
                <td>${player.id}</td>
                <td>${player.name}</td>
                <td>${player.title}</td>
                <td>${player.race}</td>
                <td>${player.profession}</td>
                <td>${player.level}</td>
                <td>${new Date(player.birthday).toLocaleDateString()}</td>
                <td>${player.banned ? "Yes" : "No"}</td>
            </tr>
        `;
            tbody.append(row); // Добавляем строки только в <tbody>
        });
    }

    //обновление пагинации
    function updatePagination(pageSize) {
        $.ajax({
            type: "GET",
            url: "rest/players/count",
            success: function (totalAccounts) {
                const totalPages = Math.ceil(totalAccounts / pageSize);
                renderPagination(totalPages);
            }
        })
    }

    //обновление кнопок пагинации
    function renderPagination(totalPages) {
        const pagination = $("#pagination");
        pagination.empty();

        for (let i = 0; i < totalPages; i++) {
            const pageButton = $("<button>" + (i + 1) + "</button>");

            pageButton.on("click", function () {
                pageNumber = i;
                loadData(pageNumber, pageSize);
                updatePagination(pageSize);
            })
            pagination.append(pageButton);
        }
    }

    //обработка размера таблицы
    $("#dropdown").on("change", function () {
        pageSize = parseInt($(this).val());
        pageNumber = 0;
        loadData(pageNumber, pageSize);
        updatePagination(pageSize);
    })


</script>
</body>
</html>